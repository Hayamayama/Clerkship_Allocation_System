# 🏥 醫院見習志願自動分配系統 (Clerkship Allocation System)

這是一個基於 Google Workspace (Sheets, Forms, Apps Script) 的自動化腳本，旨在公平、高效地為同學分配臨床見習的醫院與時段。

---

## 🚀 專案特色

* **完全自動化**：只需一鍵執行，即可在數秒內完成全班學生的分發。
* **絕對公平**：嚴格遵守抽籤的選填順序，確保流程透明、無爭議。
* **高擴展性**：可輕易透過修改 Google Sheet 來增減醫院名額、調整學生順序或指派老師。
* **零成本**：完全利用免費的 Google 工具實現，無需額外費用。

---

## 🔧 系統架構 (System Architecture)

本專案利用 Google 生態系，將資料收集、處理與結果呈現串聯起來，形成一個完整的自動化流程。

**流程圖:**
`Google Form (資料收集)` -> `Google Sheet (資料儲存)` -> `Google Apps Script (核心邏輯)` -> `Google Sheet (結果輸出)`

1.  **資料收集層 (Data Collection Layer)**
    * **工具**：**Google 表單 (Google Forms)**
    * **說明**：建立一份標準化的線上表單，供學生填寫其學號、姓名及五個實習志願。利用下拉式選單功能，確保資料格式的統一性，避免人工輸入錯誤。

2.  **資料儲存層 (Data Storage Layer)**
    * **工具**：**Google 試算表 (Google Sheets)**
    * **說明**：所有表單的回應會自動彙整於此。專案包含四個核心工作表：
        * `表單回應`：原始表單回應。
        * `選填順序表`：儲存抽籤決定的學生選填順序 (關鍵排序依據)。
        * `實習名額表`：定義所有實習時段的代碼、開放名額及負責老師。
        * `最終分發結果`：由程式自動產生的最終分配結果。

3.  **核心邏輯層 (Business Logic Layer)**
    * **工具**：**Google Apps Script**
    * **說明**：這是整個系統的大腦。程式碼 ( `main.gs` ) 執行以下核心演算法：
        * **讀取**：讀取上述三個資料工作表的數據。
        * **排序**：根據 `選填順序表`，對所有學生進行優先級排序。
        * **迭代分配**：從排序第一的學生開始，依序檢查其志願。
        * **名額檢查**：判斷學生的志願是否還有剩餘名額。若有，則分配成功；若無，則檢查下一個志願。
        * **寫入**：將所有學生的分配結果，批次寫入 `最終分發結果` 工作表。

4.  **結果呈現層 (Presentation Layer)**
    * **工具**：**Google 試算表 (Google Sheets)**
    * **說明**：`最終分發結果` 工作表清晰地展示了每位學生的學號、姓名及最終分配到的實習志願代碼，可直接匯出或分享。

---

## 🛠️ 【重要】前置設定與操作手冊

請嚴格依照以下步驟進行設定，以確保系統能正確運作。

### **第一步：建立與準備 Google Sheet**

1.  **建立 Google Sheet**：
    * 在你的 Google 雲端硬碟建立一份新的 Google 試算表，可命名為「實習志願分配總表」。
    * 在這份試算表中，建立**四個工作表分頁**，並確保名稱與下方完全一致：
        1.  `表單回應`
        2.  `選填順序表`
        3.  `實習名額表`
        4.  `最終分發結果`

2.  **準備 `實習名額表`**：
    * 這是最關鍵的資料表，定義了所有可選的志願。
    * 請建立三個欄位：`志願代碼`、`開放名額`
    * **志願代碼**：為每個「機構-時段」組合設定一個**獨一無二**的代碼 (例如 `H01`, `V01`)。
    * **開放名額**：填寫該時段可接受的學生人數 (例如 `1` 或 `2`)。

    **範例：**
    | 志願代碼 | 開放名額 |
    | :--- | :--- | 
    | H01 | 2 | 
    | H02 | 2 | 
    | V01 | 1 | 
    | ... | ... | 

3.  **準備 `選填順序表`**：
    * 根據抽籤結果，建立學生的選填順序。
    * 請建立三個欄位：`順序`、`學號`、`姓名`。
    * **重要**：此處的**學號**必須與學生在 Google 表單中填寫的學號完全一致，這是系統配對的唯一依據。

    **範例：**
    | 順序 | 學號 | 姓名 |
    | :--- | :--- | :--- |
    | 1 | S01 | 王大明 |
    | 2 | S02 | 陳小華 |
    | ... | ... | ... |

### **第二步：設計與發布 Google Form**

1.  **建立 Google Form**：
    * 建立一份新的 Google 表單。
    * 點擊「設定」，在「回應」區塊，開啟「**限制每位使用者只能回覆 1 次**」。

2.  **設計表單內容**：
    * **表單說明**：清楚寫下填寫規則、截止日期，並**強烈建議**將 `實習名額表` 的內容截圖或以文字方式貼在說明區，方便學生查閱。
    * **問題一：學號** (簡答、必填)
    * **問題二：姓名** (簡答、必填)
    * **問題三至七：第一至第五志願**
        * **問題類型**：務必使用**「下拉式選單 (Drop-down)」**。
        * **選項內容**：將 `實習名額表` 的資訊，組合成對使用者友善的格式：「`[志願代碼] - [機構名稱] - [時段] (負責老師)`」。

        **範例選項：**
        * `H01 - 稻香日照中心 - 週一 (9:00-12:00) (負責老師)`
        * `H02 - 稻香日照中心 - 週二 (9:00-12:00) (負責老師)`
        * `V01 - 北榮醫院 - 週二 (8:00-9:50) (負責老師)`
        * ... (依序加入所有選項) ...

3.  **連結至 Google Sheet**：
    * 在 Google 表單的「回應」分頁，點擊綠色的「在試算表中查看」圖示。
    * 選擇「**選取現有試算表**」，並找到你在第一步建立的「實習志願分配總表」。
    * 這會自動將表單回應連結到你的 `表單回應` 工作表。

### **第三步：安裝與執行 Apps Script**

1.  **安裝腳本**：
    * 回到你的 Google Sheet，點擊上方選單的 `擴充功能` > `Apps Script`。
    * 刪除編輯器中所有預設內容，將本專案提供的 `main.gs` 檔案中的**所有程式碼**完整複製並貼上。
    * 點擊上方的「💾」(儲存專案) 圖示。

2.  **執行分發**：
    * **重新整理**你的 Google Sheet 網頁。
    * 你會在選單列看到一個新的按鈕「**自動分發工具**」。
    * 點擊它，然後選擇「**>> 開始執行實習分發 (學號版) <<**」。

3.  **授權 (僅限首次執行)**：
    * 第一次執行時，Google 會要求你授權。
    * 請點擊「`審查權限`」，選擇你的 Google 帳號。
    * 在下一個「不安全」的警告頁面，點擊「`進階`」，然後點擊「`前往「(你的專案名稱)」(不安全)`」，最後點擊「`允許`」。這是 Apps Script 的標準授權流程，請放心操作。

4.  **查看結果**：
    * 執行完畢後，系統會跳出「分發完成」的提示。
    * 請前往 `最終分發結果` 工作表，即可看到所有學生的分配結果。

---

## 📂 專案檔案結構

* `main.gs`：包含所有核心業務邏輯的 Google Apps Script 程式碼。
* `DataTemplate.xlsx`：一個 Excel 範本檔案，展示了 Google Sheet 應有的四個工作表結構。
* `README.md`：本說明文件。
